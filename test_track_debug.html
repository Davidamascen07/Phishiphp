<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🐛 Teste com Track Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-box {
            background: white;
            border: 2px solid #007bff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            color: white;
        }
        .btn-primary { background: #007bff; }
        .btn-success { background: #28a745; }
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>🐛 Teste com Track Debug</h1>
    
    <div class="test-box">
        <h3>📊 URL Atual</h3>
        <div class="code" id="url-info"></div>
    </div>

    <div class="test-box">
        <h3>🧪 Teste Manual para track_debug.php</h3>
        <p>Este teste enviará dados diretamente para track_debug.php que mostra logs detalhados.</p>
        <button onclick="testWithDebugEndpoint()" class="btn btn-primary">🔧 Testar com Debug Endpoint</button>
        <button onclick="testOriginalEndpoint()" class="btn btn-success">📡 Testar Endpoint Original</button>
    </div>

    <div class="test-box">
        <h3>📋 Resultados dos Testes</h3>
        <div id="results" class="code">Clique nos botões acima para executar os testes...</div>
    </div>

    <script>
        // Atualizar info da URL
        document.getElementById('url-info').textContent = `
URL: ${window.location.href}
Search: ${window.location.search || '(vazio)'}
RID da URL: ${new URLSearchParams(window.location.search).get('rid') || '(não encontrado)'}
        `;

        function testWithDebugEndpoint() {
            const ridFromUrl = new URLSearchParams(window.location.search).get('rid') || '';
            
            const testData = {
                page: 0,
                trackerId: 'daxn8c',
                sess_id: 'debug_test_' + Date.now(),
                screen_res: screen.width + "x" + screen.height,
                rid: ridFromUrl,
                ip_info: null
            };

            document.getElementById('results').textContent = `ENVIANDO PARA TRACK_DEBUG.PHP:
${JSON.stringify(testData, null, 2)}

Aguardando resposta...`;

            fetch('https://loophish.local/track_debug.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(testData)
            })
            .then(response => response.text())
            .then(data => {
                document.getElementById('results').textContent = `RESPOSTA DO TRACK_DEBUG.PHP:
${data}

DADOS ENVIADOS:
${JSON.stringify(testData, null, 2)}`;
            })
            .catch(error => {
                document.getElementById('results').textContent = `ERRO:
${error}

DADOS QUE TENTAMOS ENVIAR:
${JSON.stringify(testData, null, 2)}`;
            });
        }

        function testOriginalEndpoint() {
            const ridFromUrl = new URLSearchParams(window.location.search).get('rid') || '';
            
            const testData = {
                page: 0,
                trackerId: 'daxn8c',
                sess_id: 'original_test_' + Date.now(),
                screen_res: screen.width + "x" + screen.height,
                rid: ridFromUrl,
                ip_info: null
            };

            document.getElementById('results').textContent = `ENVIANDO PARA TRACK.PHP ORIGINAL:
${JSON.stringify(testData, null, 2)}

Aguardando resposta...`;

            fetch('https://loophish.local/track', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(testData)
            })
            .then(response => response.text())
            .then(data => {
                document.getElementById('results').textContent = `RESPOSTA DO TRACK.PHP ORIGINAL:
${data}

DADOS ENVIADOS:
${JSON.stringify(testData, null, 2)}`;
            })
            .catch(error => {
                document.getElementById('results').textContent = `ERRO:
${error}

DADOS QUE TENTAMOS ENVIAR:
${JSON.stringify(testData, null, 2)}`;
            });
        }

        // Log inicial
        console.log('URL atual:', window.location.href);
        console.log('RID da URL:', new URLSearchParams(window.location.search).get('rid'));
    </script>
</body>
</html>